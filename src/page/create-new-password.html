<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Trang tạo mật khẩu mới</title>
    <link rel="stylesheet" href="../stylesheets/create-new-password.css">

</head>
<body>
<div class="khung">
    <img src="../image/logoo.png" alt="SKYDRONE Logo" class="mascot">

    <h1 id="title">Tạo mật khẩu mới</h1>

    <form id="pwdForm" class="form" novalidate>
        <div class="form-group">
            <label for="password">Mật khẩu</label>
            <div class="input-wrapper">
                <input id="password" name="password" type="password" placeholder="Nhập mật khẩu của bạn" autocomplete="new-password" required minlength="6" />
                <button type="button" class="eye-btn" aria-label="Hiện mật khẩu" data-target="password" title="Hiện/ẩn mật khẩu">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#666" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                        <path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7S1 12 1 12z"></path>
                        <circle cx="12" cy="12" r="3"></circle>
                    </svg>
                </button>
            </div>

            <div class="helper" aria-hidden="true">
                <span class="dot">i</span>
                <span>Mật khẩu tối thiểu có 6 kí tự, có ít nhất 1 chữ số và 1 chữ.</span>
            </div>
            <div id="pwdError" class="error" aria-live="polite" style="display:none;"></div>
        </div>

        <div class="form-group">
            <label for="confirm">Nhập lại mật khẩu</label>
            <div class="input-wrapper">
                <input id="confirm" name="confirm" type="password" placeholder="Nhập lại mật khẩu của bạn" autocomplete="new-password" required />
                <button type="button" class="eye-btn" aria-label="Hiện mật khẩu xác nhận" data-target="confirm" title="Hiện/ẩn mật khẩu">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#666" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                        <path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7S1 12 1 12z"></path>
                        <circle cx="12" cy="12" r="3"></circle>
                    </svg>
                </button>
            </div>
            <div id="confirmError" class="error" aria-live="polite" style="display:none;"></div>
        </div>

        <div class="nut_nhom">
            <button class="nut nut_quay_lai" onclick="quayLai()">⬅ Quay lại</button>
            <button class="nut nut_xac_nhan" onclick="xacNhan()">Xác nhận</button>
        </div>

    <div id="resultMessage" style="display:none;" aria-live="polite"></div>
</form>
</div>

<script>
    // Hiển thị / ẩn mật khẩu
    document.querySelectorAll('.eye-btn').forEach(function(btn){
        btn.addEventListener('click', function(){
            const targetId = btn.getAttribute('data-target');
            const input = document.getElementById(targetId);
            if (!input) return;
            if (input.type === 'password') {
                input.type = 'text';
                btn.setAttribute('aria-label', 'Ẩn mật khẩu');
            } else {
                input.type = 'password';
                btn.setAttribute('aria-label', 'Hiện mật khẩu');
            }
        });
    });

    // Kiểm tra điều kiện mật khẩu
    function dieuKienMatKhau(pwd) {
        const errors = [];
        if (pwd.length < 6) errors.push('Mật khẩu phải có ít nhất 6 kí tự.');
        if (!/[0-9]/.test(pwd)) errors.push('Mật khẩu phải chứa ít nhất 1 chữ số.');
        if (!/[A-Za-zÀ-ÖØ-öø-ÿ]/.test(pwd)) errors.push('Mật khẩu phải chứa ít nhất 1 chữ cái.');
        return errors;
    }

    const form = document.getElementById('pwdForm');
    const pwdInput = document.getElementById('password');
    const confirmInput = document.getElementById('confirm');
    const pwdError = document.getElementById('pwdError');
    const confirmError = document.getElementById('confirmError');
    const resultMessage = document.getElementById('resultMessage');

    form.addEventListener('submit', function(e){
        e.preventDefault();
        pwdError.style.display = 'none';
        confirmError.style.display = 'none';
        resultMessage.style.display = 'none';
        resultMessage.className = '';

        const pwd = pwdInput.value.trim();
        const cnf = confirmInput.value.trim();

        const errs = dieuKienMatKhau(pwd);
        if (errs.length > 0) {
            pwdError.innerText = errs.join(' ');
            pwdError.style.display = 'block';
            pwdInput.focus();
            return;
        }

        if (pwd !== cnf) {
            confirmError.innerText = 'Mật khẩu nhập lại không khớp.';
            confirmError.style.display = 'block';
            confirmInput.focus();
            return;
        }

        resultMessage.style.display = 'block';
        resultMessage.className = 'success';
        resultMessage.innerText = 'Mật khẩu đã được cập nhật thành công.';
        pwdInput.value = '';
        confirmInput.value = '';
    });

    function quayLai() {
        window.location.href = 'forgot-password.html';
    }

</script>
</body>
</html>
